# ğŸš€ RISC-V/APB ê¸°ë°˜ MCU ì„¤ê³„ (RISC-V/APB based MCU Design)

[cite_start]ë³¸ í”„ë¡œì íŠ¸ëŠ” **RISC-V RV32I Multi-Cycle CPU**ì™€ **AMBA APB (Advanced Peripheral Bus)** í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì–‘í•œ ì£¼ë³€ ì¥ì¹˜(Peripheral)ë¥¼ í†µí•©í•œ ë§ˆì´í¬ë¡œì»¨íŠ¸ë¡¤ëŸ¬ ìœ ë‹›(MCU) ì‹œìŠ¤í…œì„ **SystemVerilog**ë¡œ ì„¤ê³„í•˜ê³  FPGA ë³´ë“œì—ì„œ ê²€ì¦í•œ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤[cite: 31].

---

## 1. í”„ë¡œì íŠ¸ ê°œìš” (Project Overview)

### ëª©í‘œ ë° íŠ¹ì§•
* [cite_start]**í”„ë¡œì íŠ¸ ëª©í‘œ**: RV32I Multi-Cycle CPU ë° AMBA Bus Protocolì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì£¼ë³€ ì¥ì¹˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” MCUë¥¼ ì„¤ê³„í•˜ê³ , C ê¸°ë°˜ íŒì›¨ì–´ ì‘ì„± ë° ê²€ì¦ì„ ì™„ë£Œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤[cite: 31, 590, 591, 592].
* **í•µì‹¬ íŠ¹ì§•**:
    * [cite_start]í•˜ë“œì›¨ì–´ íšŒë¡œê°€ ì•„ë‹Œ **ROMì— ë‹´ê¸´ íŒì›¨ì–´**ì— ë”°ë¼ ë™ì‘ì„ ê²°ì •í•˜ëŠ” ì„ë² ë””ë“œ ì‹œìŠ¤í…œ êµ¬ì¡°ì…ë‹ˆë‹¤[cite: 35, 594].
    * [cite_start]**AMBA APB Bus**ë¥¼ ì´ìš©í•˜ì—¬ ì—¬ëŸ¬ ì£¼ë³€ ì¥ì¹˜ë“¤ì„ ì—°ê²°í–ˆìŠµë‹ˆë‹¤[cite: 35, 595].

### ê°œë°œ í™˜ê²½ ë° ë„êµ¬
| êµ¬ë¶„ | ë‚´ìš© | ì¶œì²˜ |
| :--- | :--- | :--- |
| **í•˜ë“œì›¨ì–´** | [cite_start]Digilent Basys 3 FPGA Board | [cite: 37, 597] |
| **ì†Œí”„íŠ¸ì›¨ì–´** | [cite_start]Xilinx Vivado, PuTTy | [cite: 38, 598] |
| **ì–¸ì–´** | [cite_start]SystemVerilog, C | [cite: 39, 599] |

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)

[cite_start]ì „ì²´ ì‹œìŠ¤í…œì€ RV32I Core, APB Master (`APB_Master.sv`), ê·¸ë¦¬ê³  APB Slave ì£¼ë³€ ì¥ì¹˜ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤[cite: 264, 265].

### 2.1. RISC-V RV32I Multi-Cycle CPU Core
* [cite_start]**ISA**: RISC-V ëª…ë ¹ì–´ ì„¸íŠ¸ ì•„í‚¤í…ì²˜ì˜ ê¸°ë³¸ ì •ìˆ˜(Integer) ë²„ì „ 32ë¹„íŠ¸ ëª…ë ¹ì–´ (RV32I)ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤[cite: 42, 601].
* [cite_start]**ë°©ì‹**: í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¥¼ ì—¬ëŸ¬ ë‹¨ê³„(**Fetch, Decode, Execute, Memory, Write Back**)ì— ê±¸ì³ ì‹¤í–‰í•˜ëŠ” **Multi-Cycle** ë°©ì‹ì„ ì±„íƒí•˜ì—¬ í´ëŸ­ íš¨ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤[cite: 43, 44, 602, 603].

### 2.2. AMBA APB Bus
* [cite_start]**í”„ë¡œí† ì½œ**: AMBA í”„ë¡œí† ì½œ ë‚´ì—ì„œ ê°€ì¥ ë‚®ì€ ëŒ€ì—­í­ì„ ê°€ì§€ë©°, ì €ì† ì €ì „ë ¥ ì£¼ë³€ ì¥ì¹˜ë“¤ì„ ì—°ê²°í•˜ëŠ” ë° ìµœì í™”ëœ ë²„ìŠ¤ì…ë‹ˆë‹¤[cite: 242, 244, 631].
* [cite_start]**ì „ì†¡**: **Non-pipelined** ë°©ì‹ìœ¼ë¡œ í•œ ë²ˆì— í•˜ë‚˜ì˜ ì „ì†¡ë§Œ ì²˜ë¦¬í•˜ë©°, ì£¼ì†Œì™€ ë°ì´í„°ê°€ í•œ í´ëŸ­ ì‚¬ì´í´ì— ë™ì‹œì— ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤[cite: 245, 246, 632].
* [cite_start]**ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨**: ì „ì†¡ì€ `IDLE` $\to$ `SETUP` $\to$ `ACCESS` ì˜ 3ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤[cite: 249, 252, 258].

### 2.3. ë©”ëª¨ë¦¬ ë§µ (Memory Map)
[cite_start]ì£¼ë³€ ì¥ì¹˜ë“¤ì€ `0x1000_0000` ì£¼ì†Œë¶€í„° í• ë‹¹ë©ë‹ˆë‹¤[cite: 505, 634].

| ì£¼ë³€ ì¥ì¹˜ (Peripheral) | ì˜¤í”„ì…‹ (Offset) | ì£¼ì†Œ (Base Address) | PSEL Index | íŒŒì¼ëª… |
| :--- | :--- | :--- | :--- | :--- |
| **ROM** | N/A | `0x0000_0000` | N/A | `ROM.sv` |
| **RAM** | `0x0000` | `0x1000_0000` | `PSEL0` | `RAM.sv` |
| **GPO** | `0x1000` | `0x1000_1000` | `PSEL1` | `GPO.sv` |
| **GPI** | `0x2000` | `0x1000_2000` | `PSEL2` | `GPI.sv` |
| **GPIO** | `0x3000` | `0x1000_3000` | `PSEL3` | `GPIO.sv` |
| **UART** | `0x4000` | `0x1000_4000` | `PSEL4` | `uart.sv` |

---

## 3. ì£¼ë³€ ì¥ì¹˜ ì„¸ë¶€ ì„¤ê³„ (Peripheral Details)

### 3.1. UART (`uart.sv`)
* [cite_start]**ë ˆì§€ìŠ¤í„° êµ¬ì¡°**: C ì½”ë“œì—ì„œ Data Register(DR)ëŠ” `0x00` ì˜¤í”„ì…‹, Status Register(SR)ëŠ” `0x04` ì˜¤í”„ì…‹ì— ë§¤í•‘ë©ë‹ˆë‹¤[cite: 520, 521].
    * [cite_start]**`SR[0]` (RXNE)**: ìˆ˜ì‹  ë°ì´í„° ì¤€ë¹„ í”Œë˜ê·¸ (`slv_rx_ready_flag`ì™€ ì—°ê²°)[cite: 521, 852].
    * [cite_start]**`SR[1]` (TXC)**: ì†¡ì‹  ì¤€ë¹„ ì™„ë£Œ í”Œë˜ê·¸ (`~tx_busy`ì™€ ì—°ê²°)[cite: 522, 852].
* [cite_start]**RX/TX ë™ì‘**: Data Register(`slv_reg0`)ì— ì“°ê¸° ì ‘ê·¼ ë°œìƒ ì‹œ `tx_start` í„ìŠ¤ê°€ ë°œìƒí•˜ì—¬ ì „ì†¡ì„ ì‹œì‘í•©ë‹ˆë‹¤[cite: 847, 849]. [cite_start]RX ì™„ë£Œ ì‹ í˜¸(`rx_done`)ê°€ ë“¤ì–´ì˜¤ë©´ ìˆ˜ì‹  ë°ì´í„°ê°€ `slv_reg0`ì— ë˜ì¹˜ë˜ê³  `RXNE`ê°€ ì„¤ì •ë©ë‹ˆë‹¤[cite: 844, 845].

### 3.2. GPO (`GPO.sv`)
* [cite_start]**ì œì–´ ë ˆì§€ìŠ¤í„°**: Control Register(`cr`, `slv_reg0`)ì™€ Output Data Register(`odr`, `slv_reg1`)ê°€ ìˆìŠµë‹ˆë‹¤[cite: 812].
* [cite_start]**ì¶œë ¥ ë¡œì§**: `gpo[i]`ëŠ” `cr[i]`ê°€ `1`ì¼ ë•Œë§Œ `odr[i]` ê°’ì„ ì¶œë ¥í•˜ê³ , `0`ì¼ ë•ŒëŠ” í•˜ì´ ì„í”¼ë˜ìŠ¤ ìƒíƒœ(`1'bz`)ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤[cite: 819, 820].

### 3.3. GPI (`GPI.sv`)
* [cite_start]**ì œì–´ ë ˆì§€ìŠ¤í„°**: Control Register(`cr`, `slv_reg0`)ì™€ Input Data Register(`idr`)ê°€ ìˆìŠµë‹ˆë‹¤[cite: 667].
* [cite_start]**ì…ë ¥ ë¡œì§**: `idr[i]`ëŠ” `cr[i]`ê°€ ì°¸ì¼ ë•Œë§Œ `gpi[i]` ê°’ì„ ì½ì–´ì˜µë‹ˆë‹¤[cite: 675, 676].

### 3.4. GPIO (`GPIO.sv`)
* [cite_start]**ì œì–´ ë ˆì§€ìŠ¤í„°**: Control Register(`cr`, `slv_reg0`), Output Data Register(`odr`, `slv_reg1`), Input Data Register(`idr`)ê°€ ìˆìŠµë‹ˆë‹¤[cite: 6].
* [cite_start]**ì…ì¶œë ¥ ë¡œì§**: `cr[i]`ê°€ `1`ì´ë©´ ì¶œë ¥ìœ¼ë¡œ ì„¤ì •ë˜ì–´ `odr[i]`ë¥¼ `gpio[i]`ì— í• ë‹¹í•˜ê³ , `cr[i]`ê°€ `0`ì´ë©´ ì…ë ¥ìœ¼ë¡œ ì„¤ì •ë˜ì–´ `gpio[i]`ë¥¼ `idr[i]`ì— í• ë‹¹í•©ë‹ˆë‹¤[cite: 15, 16].

---

## 4. íŒì›¨ì–´ ë° ê²€ì¦ (Firmware & Verification)

### 4.1. C ì–¸ì–´ íŒì›¨ì–´ (Test Code)
C ì–¸ì–´ë¡œ ì‘ì„±ëœ íŒì›¨ì–´ëŠ” ì£¼ë³€ ì¥ì¹˜ë“¤ì„ ì‚¬ìš©í•˜ì—¬ MCUì˜ ë™ì‘ì„ ì œì–´í•©ë‹ˆë‹¤.
* [cite_start]**ì£¼ìš” ê¸°ëŠ¥**: ì£¼ê¸°ì ìœ¼ë¡œ UARTë¡œ í˜„ì¬ ìƒíƒœ, GPO ì¶œë ¥ì„ ìˆ˜í–‰í•˜ê³ , GPIë¡œ ì„¸íŒ… ëª¨ë“œì— ì§„ì…í•˜ì—¬ UARTë¡œ ëª¨ë“œë¥¼ ì „í™˜í•˜ëŠ” íŒì›¨ì–´ ë¡œì§ì„ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤[cite: 496, 497, 644, 645].
* [cite_start]**UART ìˆ˜ì‹ **: `while (!(UART_SR & UART_SR_RXNE))` ë£¨í”„ë¥¼ í†µí•´ ìˆ˜ì‹ ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°(í´ë§)í•©ë‹ˆë‹¤[cite: 500, 504].
* [cite_start]**ì»´íŒŒì¼ ë¬¸ì œ í•´ê²°**: ì»´íŒŒì¼ëŸ¬ì—ì„œ RV32I setì´ ì•„ë‹Œ ëª…ë ¹ì–´(ì˜ˆ: `addi sp, sp, -32` ë“±)ê°€ ì»´íŒŒì¼ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ì»´íŒŒì¼ëŸ¬ ì˜µì…˜ì— `-march=rv32i -mabi=ilp32 -O0 -nostdlib -std=c99`ë¥¼ ì§€ì •í•˜ì—¬ RV32I ëª…ë ¹ì–´ë§Œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí–ˆìŠµë‹ˆë‹¤[cite: 543, 545, 652, 653].

### 4.2. SystemVerilog ê²€ì¦ (Verification)
* **ê²€ì¦ ëŒ€ìƒ**: APB-UART ì£¼ë³€ ì¥ì¹˜ (`dut (APB_UART)`)ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ì¦ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.
* **Pass ì¡°ê±´**:
    * [cite_start]**RX Pass**: `send_data == rdata` [cite: 381, 637]
    * [cite_start]**TX Pass**: `wdata == received_data` [cite: 382, 638]
* [cite_start]**ìµœì¢… ê²°ê³¼**: ì´ 512ë²ˆì˜ TX/RX ì‚¬ì´í´ ê²€ì¦ì—ì„œ **Pass tx: 512, rx: 512**ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤[cite: 468].

---



## 5. ê³ ì°° (Reflections)

[cite_start]RV32I CPUì— APB Busë¥¼ ì—°ê²°í•˜ê³  ì£¼ë³€ ì¥ì¹˜ë¥¼ ì§ì ‘ ì„¤ê³„Â·ì—°ê²°í•˜ëŠ” ê²½í—˜ì„ í†µí•´ MCUì— ê°€ê¹Œìš´ ì‹œìŠ¤í…œì„ êµ¬í˜„í•´ë³´ë©´ì„œ ì„ë² ë””ë“œ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ì™€ ë™ì‘ ì›ë¦¬ë¥¼ ì²´ê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤[cite: 549, 658]. [cite_start]RV32I ëª…ë ¹ì–´ë§Œ ì‚¬ìš© ê°€ëŠ¥í–ˆê¸° ë•Œë¬¸ì— ë³µì¡í•œ ê¸°ëŠ¥ êµ¬í˜„ì— ë¶€ì¡±í•¨ì„ ëŠê¼ˆìœ¼ë©°, í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ì˜ **ì¡°í™”ë¡œìš´ ì¡°í•©**ì´ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ë°°ì› ìŠµë‹ˆë‹¤[cite: 548, 656, 657].

## 6. ë™ì‘ ì˜ìƒ (Demo Video)
í”„ë¡œì íŠ¸ì˜ ì‹¤ì œ ë™ì‘ ëª¨ìŠµì€ ì•„ë˜ ë§í¬ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[FPGA ë™ì‘ ì˜ìƒ (Basys 3)] (https://youtu.be/JyGLBVhcDjw)
